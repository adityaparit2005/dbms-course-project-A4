<!DOCTYPE html>
<html>
<head>
    <title>SQL Query Optimizer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        textarea {
            width: 100%;
            height: 100px;
        }
        table {
            border-collapse: collapse;
            margin-top: 15px;
            width: 100%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px 10px;
            text-align: left;
        }
        th {
            background: #f4f4f4;
        }
        h3 {
            margin-top: 30px;
        }
        .error {
            color: red;
        }
        pre {
            background: #f9f9f9;
            padding: 8px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <h1>SQL Query Optimizer</h1>

    <!-- Input Form -->
    <form method="post" action="/run_query">
        <textarea name="query" placeholder="Enter your SQL query here..."></textarea>
        <br><br>
        <button type="submit">Optimize</button>
    </form>

    <!-- =================== -->
    <!-- Original Query Block -->
    <!-- =================== -->
    {% if original %}
        <h3>Original Query:</h3>
        <pre>{{ original.query }}</pre>

        {% if original.error %}
            <p class="error">Error: {{ original.error }}</p>
        {% else %}
            <h4>Execution Plan (Original):</h4>
            <table>
                <tr>
                    <th>Step</th>
                    <th>Condition</th>
                    <th>Cost</th>
                    <th>Est. Rows</th>
                    <th>Actual Time</th>
                    <th>Actual Rows</th>
                    <th>Loops</th>
                </tr>
                {% for row in original.plan %}
                <tr>
                    <td>{{ row.Step }}</td>
                    <td>{{ row.Condition }}</td>
                    <td>{{ row.Cost }}</td>
                    <td>{{ row['Est. Rows'] }}</td>
                    <td>{{ row['Actual Time'] }}</td>
                    <td>{{ row['Actual Rows'] }}</td>
                    <td>{{ row.Loops }}</td>
                </tr>
                {% endfor %}
            </table>
        {% endif %}
    {% endif %}

    <!-- =================== -->
    <!-- Optimized Query Block -->
    <!-- =================== -->
    {% if optimized %}
        <h3>Optimized Query:</h3>
        <pre>{{ optimized.query }}</pre>

        {% if optimized.error %}
            <p class="error">Error: {{ optimized.error }}</p>
        {% else %}
            <h4>Execution Plan (Optimized):</h4>
            <table>
                <tr>
                    <th>Step</th>
                    <th>Condition</th>
                    <th>Cost</th>
                    <th>Est. Rows</th>
                    <th>Actual Time</th>
                    <th>Actual Rows</th>
                    <th>Loops</th>
                </tr>
                {% for row in optimized.plan %}
                <tr>
                    <td>{{ row.Step }}</td>
                    <td>{{ row.Condition }}</td>
                    <td>{{ row.Cost }}</td>
                    <td>{{ row['Est. Rows'] }}</td>
                    <td>{{ row['Actual Time'] }}</td>
                    <td>{{ row['Actual Rows'] }}</td>
                    <td>{{ row.Loops }}</td>
                </tr>
                {% endfor %}
            </table>
        {% endif %}
    {% endif %}
</body>
</html>
